<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRONA - Bie≈ºƒÖce Raporty O Nabytych Autach</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üöó</text></svg>">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-dark bg-primary">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">
                <i class="bi bi-car-front-fill"></i> BRONA - Bie≈ºƒÖce Raporty O Nabytych Autach
            </span>
            <span class="badge bg-light text-dark">v3.0 Client-Side</span>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 sidebar bg-light p-3">
                <h5 class="mb-3"><i class="bi bi-search"></i> Wyszukiwanie</h5>
                
                <!-- Info -->
                <div class="alert alert-info alert-sm" role="alert">
                    <small>
                        <i class="bi bi-info-circle"></i> Wszystkie zapytania wykonywane sƒÖ bezpo≈õrednio z Twojej przeglƒÖdarki do API CEPiK.
                    </small>
                </div>

                <!-- Wojew√≥dztwo -->
                <div class="mb-3">
                    <label class="form-label"><strong>üìç Wojew√≥dztwo *</strong></label>
                    <select class="form-select" id="voivodeshipSelect">
                        <option value="ALL">WSZYSTKIE</option>
                    </select>
                </div>

                <!-- Zakres dat -->
                <div class="mb-3">
                    <label class="form-label"><strong>üìÖ Zakres dat *</strong></label>
                    <div class="btn-group btn-group-sm w-100 mb-2" role="group">
                        <button type="button" class="btn btn-outline-primary" id="btnPrevYear">Poprzedni rok</button>
                        <button type="button" class="btn btn-outline-primary" id="btnCurrentYear">Bie≈ºƒÖcy rok</button>
                        <button type="button" class="btn btn-outline-primary" id="btnCurrentMonth">Bie≈ºƒÖcy miesiƒÖc</button>
                    </div>
                    <div class="row g-2">
                        <div class="col-6">
                            <label class="form-label small">Data od</label>
                            <input type="date" class="form-control form-control-sm" id="dateFrom">
                        </div>
                        <div class="col-6">
                            <label class="form-label small">Data do</label>
                            <input type="date" class="form-control form-control-sm" id="dateTo">
                        </div>
                    </div>
                </div>

                <!-- Filtry -->
                <div class="accordion accordion-flush" id="filtersAccordion">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#filtersCollapse">
                                üîß Filtry wyszukiwania
                            </button>
                        </h2>
                        <div id="filtersCollapse" class="accordion-collapse collapse show" data-bs-parent="#filtersAccordion">
                            <div class="accordion-body">
                                <!-- Marka -->
                                <div class="mb-3">
                                    <label class="form-label small">Marka pojazdu</label>
                                    <select class="form-select form-select-sm" id="brandFilter">
                                        <option value="">-- Wszystkie --</option>
                                    </select>
                                </div>

                                <!-- Model -->
                                <div class="mb-3">
                                    <label class="form-label small">Model pojazdu</label>
                                    <input type="text" class="form-control form-control-sm" id="modelFilter" placeholder="np. X5, COROLLA">
                                </div>

                                <!-- Rok produkcji -->
                                <div class="mb-3">
                                    <label class="form-label small">Rok produkcji</label>
                                    <div class="row g-2">
                                        <div class="col-6">
                                            <input type="number" class="form-control form-control-sm" id="yearFrom" placeholder="Od" value="2020" min="1900" max="2030">
                                        </div>
                                        <div class="col-6">
                                            <input type="number" class="form-control form-control-sm" id="yearTo" placeholder="Do" value="2025" min="1900" max="2030">
                                        </div>
                                    </div>
                                </div>

                                <!-- Rodzaj pojazdu -->
                                <div class="mb-3">
                                    <label class="form-label small">Rodzaj pojazdu</label>
                                    <select class="form-select form-select-sm" id="vehicleTypeFilter">
                                        <option value="">-- Wszystkie --</option>
                                    </select>
                                </div>

                                <!-- Rodzaj paliwa -->
                                <div class="mb-3">
                                    <label class="form-label small">Rodzaj paliwa</label>
                                    <select class="form-select form-select-sm" id="fuelTypeFilter">
                                        <option value="">-- Wszystkie --</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dodaj do istniejƒÖcych -->
                <div class="form-check mb-3 mt-3">
                    <input class="form-check-input" type="checkbox" id="appendMode">
                    <label class="form-check-label small" for="appendMode">
                        ‚ûï Dodaj do istniejƒÖcych danych
                    </label>
                </div>

                <!-- Przycisk wyszukiwania -->
                <button class="btn btn-primary w-100 mb-2" id="searchBtn">
                    <i class="bi bi-search"></i> Wyszukaj pojazdy
                </button>

                <!-- Przycisk czyszczenia -->
                <button class="btn btn-outline-secondary w-100" id="clearBtn" style="display: none;">
                    <i class="bi bi-trash"></i> Wyczy≈õƒá dane
                </button>

                <hr class="my-3">
                <small class="text-muted"><strong>* Pola wymagane</strong></small>
            </div>

            <!-- Main content -->
            <div class="col-md-9 col-lg-10 p-4">
                <!-- Welcome screen -->
                <div id="welcomeScreen">
                    <div class="jumbotron">
                        <h2>Witaj w aplikacji BRONA! üëã</h2>
                        <p class="lead">Wyszukiwarka i analiza danych o pojazdach zarejestrowanych w Polsce (baza CEPiK)</p>
                        
                        <div class="card mt-4">
                            <div class="card-body">
                                <h5>Jak korzystaƒá:</h5>
                                <ol>
                                    <li><strong>Wybierz wojew√≥dztwo</strong> w panelu po lewej (domy≈õlnie: wszystkie)</li>
                                    <li><strong>Wybierz zakres dat</strong> pierwszej rejestracji (u≈ºyj przycisk√≥w skr√≥tu)</li>
                                    <li><strong>Ustaw filtry</strong> - marka, model, rok produkcji, rodzaj pojazdu</li>
                                    <li><strong>Kliknij "üîç Wyszukaj pojazdy"</strong> aby pobraƒá dane z API CEPiK</li>
                                    <li><strong>Analizuj wyniki</strong> - filtruj, sortuj, generuj wykresy</li>
                                    <li><strong>Eksportuj</strong> dane do pliku CSV</li>
                                </ol>
                            </div>
                        </div>

                        <div class="alert alert-warning mt-4" role="alert">
                            <h6><i class="bi bi-exclamation-triangle"></i> Wa≈ºne informacje:</h6>
                            <ul class="mb-0">
                                <li>‚è±Ô∏è Pobieranie danych dla wszystkich wojew√≥dztw mo≈ºe potrwaƒá kilka minut</li>
                                <li>üåê Wszystkie zapytania sƒÖ wykonywane bezpo≈õrednio z Twojej przeglƒÖdarki</li>
                                <li>üîç Mo≈ºesz ≈ÇƒÖczyƒá wyniki z wielu zapyta≈Ñ</li>
                                <li>üíæ Pobrane dane pozostajƒÖ w pamiƒôci przeglƒÖdarki (nie na serwerze)</li>
                                <li>üìà Aplikacja nie obciƒÖ≈ºa serwera - dzia≈Ça w 100% po stronie klienta</li>
                            </ul>
                        </div>

                        <div class="card mt-4">
                            <div class="card-body">
                                <h6>≈πr√≥d≈Ço danych:</h6>
                                <p><a href="https://api.cepik.gov.pl/" target="_blank">API CEPiK</a> - Centralna Ewidencja Pojazd√≥w i Kierowc√≥w</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Loading indicator -->
                <div id="loadingScreen" style="display: none;">
                    <div class="text-center">
                        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                            <span class="visually-hidden">≈Åadowanie...</span>
                        </div>
                        <h4 class="mt-3" id="loadingMessage">Wyszukiwanie...</h4>
                        <div class="progress mt-3" style="height: 30px;">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" id="progressBar" role="progressbar" style="width: 0%">0%</div>
                        </div>
                        <div id="statusDetails" class="mt-3"></div>
                    </div>
                </div>

                <!-- Results screen -->
                <div id="resultsScreen" style="display: none;">
                    <h3><i class="bi bi-clipboard-data"></i> Wyniki wyszukiwania</h3>
                    
                    <!-- Search info -->
                    <div class="alert alert-info" id="searchInfo"></div>

                    <!-- Statistics -->
                    <div class="row mb-4">
                        <div class="col-md-2">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h6 class="card-title">Wszystkich</h6>
                                    <h3 id="statTotal">0</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h6 class="card-title">Po filtrach</h6>
                                    <h3 id="statFiltered">0</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h6 class="card-title">Unikalne marki</h6>
                                    <h3 id="statBrands">0</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h6 class="card-title">≈öredni rok</h6>
                                    <h3 id="statAvgYear">0</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h6 class="card-title">% pokazanych</h6>
                                    <h3 id="statPercent">0%</h3>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Data filters -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5><i class="bi bi-funnel"></i> Filtruj wyniki</h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <label class="form-label">Marka</label>
                                    <select class="form-select" id="filterBrand" multiple size="5">
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Rodzaj pojazdu</label>
                                    <select class="form-select" id="filterVehicleType" multiple size="5">
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Rodzaj paliwa</label>
                                    <select class="form-select" id="filterFuelType" multiple size="5">
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Rok produkcji</label>
                                    <input type="range" class="form-range" id="filterYearRange" min="1900" max="2030" step="1">
                                    <div class="d-flex justify-content-between">
                                        <span id="filterYearMin">1900</span>
                                        <span id="filterYearMax">2030</span>
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-sm btn-secondary mt-3" id="resetFiltersBtn">
                                <i class="bi bi-arrow-counterclockwise"></i> Resetuj filtry
                            </button>
                        </div>
                    </div>

                    <!-- Visualizations -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5><i class="bi bi-bar-chart"></i> Wizualizacje</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label class="form-label">Typ wykresu</label>
                                    <select class="form-select" id="chartType">
                                        <option value="bar">S≈Çupkowy (Bar)</option>
                                        <option value="pie">Ko≈Çowy (Pie)</option>
                                        <option value="histogram">Histogram</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Kolumna do analizy</label>
                                    <select class="form-select" id="chartColumn">
                                        <option value="marka">Marka</option>
                                        <option value="rodzaj-pojazdu">Rodzaj pojazdu</option>
                                        <option value="rodzaj-paliwa">Rodzaj paliwa</option>
                                        <option value="rok-produkcji">Rok produkcji</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Top N (dla bar/pie)</label>
                                    <input type="number" class="form-control" id="chartTopN" value="15" min="5" max="50">
                                </div>
                            </div>
                            <button class="btn btn-primary" id="generateChartBtn">
                                <i class="bi bi-graph-up"></i> Generuj wykres
                            </button>
                            <div id="chartContainer" class="mt-4"></div>
                        </div>
                    </div>

                    <!-- Data table -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5><i class="bi bi-table"></i> Lista pojazd√≥w</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover" id="vehiclesTable">
                                    <thead>
                                        <tr>
                                            <th>Lp.</th>
                                            <th class="sortable" data-column="marka">Marka <i class="bi bi-arrow-down-up"></i></th>
                                            <th class="sortable" data-column="model">Model <i class="bi bi-arrow-down-up"></i></th>
                                            <th class="sortable" data-column="rok-produkcji">Rok prod. <i class="bi bi-arrow-down-up"></i></th>
                                            <th class="sortable" data-column="rodzaj-pojazdu">Rodzaj <i class="bi bi-arrow-down-up"></i></th>
                                            <th class="sortable" data-column="rodzaj-paliwa">Paliwo <i class="bi bi-arrow-down-up"></i></th>
                                            <th class="sortable" data-column="pojemnosc-skokowa-silnika">Pojemno≈õƒá <i class="bi bi-arrow-down-up"></i></th>
                                            <th class="sortable" data-column="masa-wlasna">Masa <i class="bi bi-arrow-down-up"></i></th>
                                        </tr>
                                    </thead>
                                    <tbody id="vehiclesTableBody">
                                    </tbody>
                                </table>
                            </div>
                            <div class="d-flex justify-content-between align-items-center mt-3">
                                <div>
                                    <span>Poka≈º </span>
                                    <select class="form-select form-select-sm d-inline-block w-auto" id="pageSize">
                                        <option value="25">25</option>
                                        <option value="50">50</option>
                                        <option value="100" selected>100</option>
                                        <option value="250">250</option>
                                    </select>
                                    <span> wpis√≥w</span>
                                </div>
                                <nav>
                                    <ul class="pagination pagination-sm mb-0" id="pagination">
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>

                    <!-- Export -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5><i class="bi bi-download"></i> Eksport danych</h5>
                        </div>
                        <div class="card-body">
                            <button class="btn btn-success" id="exportCsvBtn">
                                <i class="bi bi-file-earmark-spreadsheet"></i> Pobierz jako CSV
                            </button>
                            <button class="btn btn-info" id="exportJsonBtn">
                                <i class="bi bi-filetype-json"></i> Pobierz jako JSON
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-light text-center text-muted py-3 mt-5">
        <div class="container">
            <p class="mb-0"><strong>BRONA - Bie≈ºƒÖce Raporty O Nabytych Autach</strong></p>
            <p class="mb-0">Dane pochodzƒÖ z Centralnej Ewidencji Pojazd√≥w i Kierowc√≥w (CEPiK)</p>
            <p class="mb-0">Aplikacja stworzona jako statyczna strona HTML/JS | ¬© 2025 | v3.0</p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="app.js"></script>
</body>
</html>

